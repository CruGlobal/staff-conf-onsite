form.instance_exec do
  collection = [:stays, object.stays.order(:arrived_at)]

  panel 'Housing Assignments', class: 'housing_assignments',
                               'data-housing_unit-container' => true do
    has_many :stays, heading: nil, for: collection do |f|
      select_housing_unit_widget(f)

      datepicker_input(f, :arrived_at)
      datepicker_input(f, :departed_at)

      dynamic_stay_input(f, :percentage)
      dynamic_stay_input(f, :single_occupancy)
      dynamic_stay_input(f, :no_charge)
      dynamic_stay_input(f, :waive_minimum)

      f.input :comment, input_html: { rows: 4 }
      f.input :_destroy, as: :boolean, wrapper_html: { class: 'destroy' }
    end
  end
end
